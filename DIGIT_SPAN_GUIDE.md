# 数字广度测试集成指南

## 概述

数字广度测试已成功集成到JavaScript版本的Baba is You实验中。这个测试评估参与者的短期记忆和工作记忆能力，包括正序和倒序两个部分。

## 功能特点

### 测试结构
- **正序测试**: 参与者按听到的顺序回忆数字序列
- **倒序测试**: 参与者按相反的顺序回忆数字序列
- **自适应长度**: 从较短的序列开始，根据表现调整长度
- **音频播放**: 使用预录制的数字音频文件（0-9）

### 技术实现
- 基于jsPsych框架的自定义插件
- Web Audio API支持高质量音频播放
- 响应式设计，支持桌面和移动设备
- 实时数据收集和结果计算

## 文件结构

### 新增文件
```
baba_js_version/
├── js/
│   └── jspsych-digit-span.js          # 数字广度测试插件
├── test-digit-span.html               # 独立测试页面
└── DIGIT_SPAN_GUIDE.md               # 本指南文档
```

### 修改文件
```
baba_js_version/
├── main.html                          # 添加了插件引用
├── js/experiment.js                   # 集成了数字广度测试到主实验
└── css/baba-game.css                  # 添加了相关样式
```

## 使用方法

### 运行完整实验
1. 打开 `main.html`
2. 实验将按以下顺序进行：
   - 欢迎页面和总体说明
   - Baba is You游戏任务
   - 解谜任务总体表现评分
   - 数字广度测试（正序）
   - 数字广度测试（倒序）

### 独立测试数字广度
1. 打开 `test-digit-span.html`
2. 可以单独运行数字广度测试
3. 适用于调试和功能验证

## 测试参数

### 默认配置
```javascript
{
    mode: 'forward' | 'backward',      // 测试模式
    starting_length: 3,                // 起始序列长度
    max_length: 9,                     // 最大序列长度
    trials_per_length: 1,              // 每个长度的试验次数
    max_total_trials: 14,              // 最大总试验次数
    digit_duration: 0.5,               // 每个数字播放时长（秒）
    digit_interval: 1.0,               // 数字间隔时长（秒）
    participant_id: '',                // 参与者ID
}
```

### 可自定义参数
- 测试长度和难度级别
- 音频播放时间
- 试验次数限制
- 界面语言和样式

## 数据输出

### 单次试验数据
```javascript
{
    mode: 'forward',                   // 测试模式
    sequence: [3, 7, 1, 9],           // 播放的数字序列
    response: [3, 7, 1, 9],           // 用户响应
    correct: true,                     // 是否正确
    sequence_length: 4,                // 序列长度
    trial_number: 1,                   // 试验编号
    total_trials: 1,                   // 已完成总试验数
    reaction_time: 2.345,              // 反应时间（秒）
    max_length_achieved: 6,            // 最大完成长度
    mean_span: 5.2,                    // 平均广度分数
    participant_id: 'P_001',           // 参与者ID
    all_results: {...}                 // 完整结果数据
}
```

### 计算指标
- **最大长度 (ML)**: 正确回忆的最长序列长度
- **平均广度 (MS)**: 基于50%正确率的估计分数
- **反应时间**: 从开始输入到完成的时间
- **正确率**: 按序列长度分组的准确性

## 音频资源

### 文件位置
音频文件位于项目根目录的 `audio/` 文件夹中：
```
audio/
├── digit_0.wav
├── digit_1.wav
├── digit_2.wav
├── ...
└── digit_9.wav
```

### 备用方案
如果音频文件加载失败，系统会自动生成合成音频作为备用方案。这种情况在以下场景中可能发生：
- 使用file://协议直接打开HTML文件（CORS限制）
- 音频文件缺失或路径错误
- 浏览器不支持WAV格式

系统会为每个数字生成不同频率的音调，确保测试能够正常进行。

## 界面特点

### 用户体验
- 清晰的英文说明和提示（与Python版本一致）
- 直观的音频播放指示
- 实时输入反馈
- 简洁的按钮和交互设计

### 响应式设计
- 支持不同屏幕尺寸
- 移动设备友好
- 自适应字体和布局

## 技术要求

### 浏览器兼容性
- Chrome 66+
- Firefox 60+
- Safari 11.1+
- Edge 79+

### 功能依赖
- Web Audio API
- ES6+ JavaScript特性
- jsPsych 7.x框架

## 故障排除

### 常见问题

1. **音频无法播放**
   - 检查音频文件是否存在
   - 确认浏览器支持Web Audio API
   - 检查文件路径是否正确
   - **CORS错误解决方案**：
     - 推荐使用本地HTTP服务器（如Live Server扩展）
     - 或者依赖合成音频备用方案（会自动启用）

2. **插件无法加载**
   - 确认HTML文件中包含了插件引用
   - 检查JavaScript控制台错误信息
   - 验证jsPsych核心库已正确加载

3. **样式显示异常**
   - 确认CSS文件已正确引入
   - 检查浏览器兼容性
   - 清除浏览器缓存

### 调试建议
- 使用浏览器开发者工具查看控制台输出
- 检查网络请求状态
- 验证音频文件格式和大小

## 未来改进

### 计划功能
- 多语言支持
- 更多自定义选项
- 数据导出功能
- 性能优化

### 扩展可能性
- 支持其他认知测试
- 与服务器数据同步
- 高级统计分析
- 实时结果可视化

## 联系支持

如有技术问题或改进建议，请查看代码注释或联系开发团队。 