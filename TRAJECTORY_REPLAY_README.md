# Baba Game 轨迹复现工具

## 功能说明

这个工具可以复现被试在Baba Game中的实际移动轨迹，支持以下功能：

1. **数据文件选择**: 支持读取CSV格式的轨迹数据文件
2. **被试和关卡选择**: 根据数据文件自动筛选可用的被试ID和关卡ID
3. **自动操作选择**: 自动选择第一个操作ID，无需手动选择
4. **真实游戏界面**: 使用真实的游戏图片资源，与原始游戏界面保持一致
5. **轨迹播放控制**: 支持播放、暂停、重置、单步执行等控制功能
6. **速度调节**: 支持0.5x到10x的播放速度调节
7. **详细日志**: 显示每一步的操作类型、方向和效果

## 使用方法

### 1. 准备数据文件
确保您有包含以下字段的CSV文件：
- `participant_id`: 被试ID
- `level_id`: 关卡ID  
- `operation_id`: 操作ID
- `dir_x`, `dir_y`: 移动方向
- `meta_type`: 元操作类型（如undo、pause等）
- `is_meta_operation`: 是否为元操作

### 2. 启动工具
1. 在浏览器中打开 `trajectory_replay.html`
2. 点击"选择文件"按钮，选择您的CSV数据文件
3. 从下拉菜单中选择被试ID和关卡ID
4. 点击"加载游戏"按钮

### 3. 播放控制
- **播放**: 开始自动播放轨迹
- **暂停**: 暂停当前播放
- **重置**: 重置到初始状态
- **单步**: 执行下一步操作
- **速度**: 调节播放速度

## 技术特性

### 图片资源支持
- 自动加载 `images/` 和 `text_images/` 文件夹中的图片
- 支持链子(chain)的方向自动判断
- 红色对象会显示红色边框
- 图片加载失败时自动降级为颜色方块

### 操作类型支持
- **移动操作**: 根据 `dir_x` 和 `dir_y` 执行移动
- **Undo操作**: 撤销上一步操作
- **Pause/Resume**: 暂停和恢复操作
- **其他元操作**: 根据 `meta_type` 字段处理

### 界面优化
- 现代化的用户界面设计
- 响应式布局，支持不同屏幕尺寸
- 详细的进度显示和日志记录
- 直观的操作控制按钮

## 文件结构

```
baba_js_version/
├── trajectory_replay.html          # 主工具文件
├── js/
│   ├── game-engine.js             # 游戏引擎
│   └── level-data.js              # 关卡数据
├── images/                        # 游戏对象图片
├── text_images/                   # 文字图片
└── TRAJECTORY_REPLAY_README.md    # 说明文档
```

## 注意事项

1. 确保CSV文件格式正确，包含必要的字段
2. 图片资源文件需要放在正确的文件夹中
3. 某些特殊对象可能需要额外的图片文件
4. 建议使用现代浏览器以获得最佳体验

## 故障排除

### 图片无法显示
- 检查 `images/` 和 `text_images/` 文件夹是否存在
- 确认图片文件名与对象类型匹配
- 查看浏览器控制台的错误信息

### 数据加载失败
- 检查CSV文件格式是否正确
- 确认文件编码为UTF-8
- 验证必要字段是否存在

### 游戏无法加载
- 确认关卡ID在 `level-data.js` 中存在
- 检查游戏引擎文件是否正确加载
- 查看浏览器控制台的错误信息 